{"ast":null,"code":"/**\n * Copyright (c) 2024 Amuse Labs Pvt Ltd\n * Grabble - Scrabble with Gravity\n * Game state manager for turn order, player management, and game lifecycle\n */import{GrabbleEngine}from'./game-engine';/**\n * Game state manager - handles game initialization, player management, and lifecycle\n */export class GameStateManager{/**\n     * Create a new game with specified number of players\n     */static createNewGame(numPlayers,playerNames){let targetScore=arguments.length>2&&arguments[2]!==undefined?arguments[2]:100;if(numPlayers<2||numPlayers>4){throw new Error('Game must have 2-4 players');}if(playerNames.length!==numPlayers){throw new Error('Player names array must match number of players');}// Create tile bag\nconst tileBag=GrabbleEngine.createTileBag();// Create players with random turn order\nconst turnOrders=[0,1,2,3].slice(0,numPlayers);// Shuffle turn orders\nfor(let i=turnOrders.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[turnOrders[i],turnOrders[j]]=[turnOrders[j],turnOrders[i]];}const playerColors=['#FF6B6B','#4ECDC4','#45B7D1','#FFA07A'];// Distinct colors for 4 players\nconst players=playerNames.map((name,index)=>({id:index,name,color:playerColors[index],score:0,rack:[],turnOrder:turnOrders[index]}));// Deal initial tiles to each player\nfor(const player of players){for(let i=0;i<7;i++){if(tileBag.length>0){player.rack.push(tileBag.pop());}}}// Find starting player (lowest turnOrder)\nconst startingPlayer=players.reduce((min,p)=>p.turnOrder<min.turnOrder?p:min);const state={board:GrabbleEngine.createEmptyBoard(),players,currentPlayerId:startingPlayer.id,tileBag,claimedWords:[],targetScore,gameStatus:'playing'};return new GameStateManager(state);}/**\n     * Load game from saved state\n     */static loadGame(state){return new GameStateManager(state);}constructor(state){this.engine=void 0;this.state=void 0;this.state=state;this.engine=new GrabbleEngine(state);}/**\n     * Get current game state\n     */getState(){return this.engine.getState();}/**\n     * Get game engine (for game logic operations)\n     */getEngine(){return this.engine;}/**\n     * Get current player\n     */getCurrentPlayer(){const player=this.state.players.find(p=>p.id===this.state.currentPlayerId);if(!player){throw new Error(\"Current player \".concat(this.state.currentPlayerId,\" not found\"));}return player;}/**\n     * Get player by ID\n     */getPlayer(playerId){return this.state.players.find(p=>p.id===playerId);}/**\n     * Get all players sorted by turn order\n     */getPlayersByTurnOrder(){return[...this.state.players].sort((a,b)=>a.turnOrder-b.turnOrder);}/**\n     * Check if it's a specific player's turn\n     */isPlayerTurn(playerId){return this.state.currentPlayerId===playerId;}/**\n     * Get game status\n     */getGameStatus(){return this.state.gameStatus;}/**\n     * Check if game is finished\n     */isGameFinished(){return this.state.gameStatus==='finished';}/**\n     * Get winner if game is finished\n     */getWinner(){if(!this.isGameFinished()||this.state.winnerId===undefined){return null;}return this.getPlayer(this.state.winnerId)||null;}/**\n     * End game and determine winner (highest score)\n     * Called when no legal moves remain\n     */endGame(){// Find player with highest score\nconst winner=this.state.players.reduce((max,p)=>p.score>max.score?p:max);this.state.gameStatus='finished';this.state.winnerId=winner.id;return winner;}/**\n     * Serialize game state for storage\n     */serialize(){return JSON.stringify(this.state);}/**\n     * Deserialize game state from storage\n     */static deserialize(serialized){const state=JSON.parse(serialized);return new GameStateManager(state);}/**\n     * Get claimed words for a specific player\n     */getClaimedWordsForPlayer(playerId){return this.state.claimedWords.filter(cw=>cw.playerId===playerId);}/**\n     * Get all claimed words\n     */getAllClaimedWords(){return[...this.state.claimedWords];}/**\n     * Get player scores as array\n     */getPlayerScores(){return this.state.players.map(p=>({playerId:p.id,name:p.name,score:p.score}));}/**\n     * Get leaderboard (players sorted by score, descending)\n     */getLeaderboard(){return[...this.state.players].sort((a,b)=>b.score-a.score);}}","map":{"version":3,"names":["GrabbleEngine","GameStateManager","createNewGame","numPlayers","playerNames","targetScore","arguments","length","undefined","Error","tileBag","createTileBag","turnOrders","slice","i","j","Math","floor","random","playerColors","players","map","name","index","id","color","score","rack","turnOrder","player","push","pop","startingPlayer","reduce","min","p","state","board","createEmptyBoard","currentPlayerId","claimedWords","gameStatus","loadGame","constructor","engine","getState","getEngine","getCurrentPlayer","find","concat","getPlayer","playerId","getPlayersByTurnOrder","sort","a","b","isPlayerTurn","getGameStatus","isGameFinished","getWinner","winnerId","endGame","winner","max","serialize","JSON","stringify","deserialize","serialized","parse","getClaimedWordsForPlayer","filter","cw","getAllClaimedWords","getPlayerScores","getLeaderboard"],"sources":["/Users/sanyasharma/Documents/grabble/react-ui/src/game-engine/game-state-manager.ts"],"sourcesContent":["/**\n * Copyright (c) 2024 Amuse Labs Pvt Ltd\n * Grabble - Scrabble with Gravity\n * Game state manager for turn order, player management, and game lifecycle\n */\n\nimport type { GameState, Player, Tile } from './types';\nimport { GrabbleEngine } from './game-engine';\n\n/**\n * Game state manager - handles game initialization, player management, and lifecycle\n */\nexport class GameStateManager {\n    private engine: GrabbleEngine;\n    private state: GameState;\n\n    /**\n     * Create a new game with specified number of players\n     */\n    static createNewGame(\n        numPlayers: number,\n        playerNames: string[],\n        targetScore: number = 100\n    ): GameStateManager {\n        if (numPlayers < 2 || numPlayers > 4) {\n            throw new Error('Game must have 2-4 players');\n        }\n        if (playerNames.length !== numPlayers) {\n            throw new Error('Player names array must match number of players');\n        }\n\n        // Create tile bag\n        const tileBag = GrabbleEngine.createTileBag();\n\n        // Create players with random turn order\n        const turnOrders = [0, 1, 2, 3].slice(0, numPlayers);\n        // Shuffle turn orders\n        for (let i = turnOrders.length - 1; i > 0; i--) {\n            const j = Math.floor(Math.random() * (i + 1));\n            [turnOrders[i], turnOrders[j]] = [turnOrders[j], turnOrders[i]];\n        }\n\n        const playerColors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A']; // Distinct colors for 4 players\n        const players: Player[] = playerNames.map((name, index) => ({\n            id: index,\n            name,\n            color: playerColors[index],\n            score: 0,\n            rack: [],\n            turnOrder: turnOrders[index]\n        }));\n\n        // Deal initial tiles to each player\n        for (const player of players) {\n            for (let i = 0; i < 7; i++) {\n                if (tileBag.length > 0) {\n                    player.rack.push(tileBag.pop()!);\n                }\n            }\n        }\n\n        // Find starting player (lowest turnOrder)\n        const startingPlayer = players.reduce((min, p) => \n            p.turnOrder < min.turnOrder ? p : min\n        );\n\n        const state: GameState = {\n            board: GrabbleEngine.createEmptyBoard(),\n            players,\n            currentPlayerId: startingPlayer.id,\n            tileBag,\n            claimedWords: [],\n            targetScore,\n            gameStatus: 'playing'\n        };\n\n        return new GameStateManager(state);\n    }\n\n    /**\n     * Load game from saved state\n     */\n    static loadGame(state: GameState): GameStateManager {\n        return new GameStateManager(state);\n    }\n\n    private constructor(state: GameState) {\n        this.state = state;\n        this.engine = new GrabbleEngine(state);\n    }\n\n    /**\n     * Get current game state\n     */\n    getState(): GameState {\n        return this.engine.getState();\n    }\n\n    /**\n     * Get game engine (for game logic operations)\n     */\n    getEngine(): GrabbleEngine {\n        return this.engine;\n    }\n\n    /**\n     * Get current player\n     */\n    getCurrentPlayer(): Player {\n        const player = this.state.players.find(p => p.id === this.state.currentPlayerId);\n        if (!player) {\n            throw new Error(`Current player ${this.state.currentPlayerId} not found`);\n        }\n        return player;\n    }\n\n    /**\n     * Get player by ID\n     */\n    getPlayer(playerId: number): Player | undefined {\n        return this.state.players.find(p => p.id === playerId);\n    }\n\n    /**\n     * Get all players sorted by turn order\n     */\n    getPlayersByTurnOrder(): Player[] {\n        return [...this.state.players].sort((a, b) => a.turnOrder - b.turnOrder);\n    }\n\n    /**\n     * Check if it's a specific player's turn\n     */\n    isPlayerTurn(playerId: number): boolean {\n        return this.state.currentPlayerId === playerId;\n    }\n\n    /**\n     * Get game status\n     */\n    getGameStatus(): 'waiting' | 'playing' | 'finished' {\n        return this.state.gameStatus;\n    }\n\n    /**\n     * Check if game is finished\n     */\n    isGameFinished(): boolean {\n        return this.state.gameStatus === 'finished';\n    }\n\n    /**\n     * Get winner if game is finished\n     */\n    getWinner(): Player | null {\n        if (!this.isGameFinished() || this.state.winnerId === undefined) {\n            return null;\n        }\n        return this.getPlayer(this.state.winnerId) || null;\n    }\n\n    /**\n     * End game and determine winner (highest score)\n     * Called when no legal moves remain\n     */\n    endGame(): Player {\n        // Find player with highest score\n        const winner = this.state.players.reduce((max, p) => \n            p.score > max.score ? p : max\n        );\n\n        this.state.gameStatus = 'finished';\n        this.state.winnerId = winner.id;\n\n        return winner;\n    }\n\n    /**\n     * Serialize game state for storage\n     */\n    serialize(): string {\n        return JSON.stringify(this.state);\n    }\n\n    /**\n     * Deserialize game state from storage\n     */\n    static deserialize(serialized: string): GameStateManager {\n        const state: GameState = JSON.parse(serialized);\n        return new GameStateManager(state);\n    }\n\n    /**\n     * Get claimed words for a specific player\n     */\n    getClaimedWordsForPlayer(playerId: number) {\n        return this.state.claimedWords.filter(cw => cw.playerId === playerId);\n    }\n\n    /**\n     * Get all claimed words\n     */\n    getAllClaimedWords() {\n        return [...this.state.claimedWords];\n    }\n\n    /**\n     * Get player scores as array\n     */\n    getPlayerScores(): Array<{ playerId: number; name: string; score: number }> {\n        return this.state.players.map(p => ({\n            playerId: p.id,\n            name: p.name,\n            score: p.score\n        }));\n    }\n\n    /**\n     * Get leaderboard (players sorted by score, descending)\n     */\n    getLeaderboard(): Player[] {\n        return [...this.state.players].sort((a, b) => b.score - a.score);\n    }\n}\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}